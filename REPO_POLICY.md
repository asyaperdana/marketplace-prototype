# Repository Governance Policy

> **STATUS**: ENFORCED
> **STRICTNESS**: BLOCKING
> **SCOPE**: Entire Repository

## 1. Core Philosophy: Source-Only Architecture

This repository operates under a strict **Source-Only** architecture.
**Rule**: The version control system (git) is for _source code_ and _configuration_ only. It is effectively a "clean room" environment.

### ðŸš« STRICTLY FORBIDDEN

Files generated by tools, build processes, or runtime environments are **never** allowed in the repository.

### âœ… ALLOWED

Only files created manually by developers or required static configuration are allowed.

---

## 2. Directory Classification Map

| Classification  | Definition           | Examples                           | Governance Rule         |
| :-------------- | :------------------- | :--------------------------------- | :---------------------- |
| **[SOURCE]**    | Manual code & assets | `src/`, `static/`, `tests/`        | **MUST TRACK**          |
| **[CONFIG]**    | Tool settings        | `package.json`, `svelte.config.js` | **MUST TRACK**          |
| **[DOCS]**      | Documentation        | `README.md`, `docs/`               | **MUST TRACK**          |
| **[GENERATED]** | Framework outputs    | `.svelte-kit/`, `.output/`         | **MUST IGNORE & BLOCK** |
| **[BUILD]**     | Compiled artifacts   | `build/`, `dist/`, `package/`      | **MUST IGNORE & BLOCK** |
| **[RUNTIME]**   | Dependencies & cache | `node_modules/`, `.cache/`         | **MUST IGNORE & BLOCK** |
| **[TEMP]**      | Logs & temp files    | `*.log`, `.DS_Store`               | **MUST IGNORE & BLOCK** |

---

## 3. Enforcement Layers

The policy is enforced efficiently at multiple stages:

| Layer         | specific   | Action               | Mechanism                               |
| :------------ | :--------- | :------------------- | :-------------------------------------- |
| **1. Local**  | Git Ignore | Hides artifacts      | `.gitignore`                            |
| **2. Commit** | Pre-commit | **BLOCKS** bad files | `husky` + `check-staged-files.sh`       |
| **3. Push**   | Pre-push   | **BLOCKS** bad tree  | `husky` + `verify-repo.sh`              |
| **4. Remote** | CI/CD      | **FAILS** pipeline   | `governance.yml` + `npm run repo:check` |

---

## 4. Violation Handling & Recovery

If a violation occurs (e.g., you accidentally force-added a file, or the CI failed):

### ðŸš¨ Case 1: Local Violation (Pre-commit/Push Blocked)

**Fix:** Unstage using the suggested command in the error message.

```bash
git reset HEAD <file>
```

### ðŸš¨ Case 2: Repository Pollution (Already Committed)

**Fix:** Use the auto-repair tool.

```bash
npm run repo:fix
```

_This command will auto-detect forbidden files, un-track them, and clean your workspace._

### ðŸš¨ Case 3: CI Failure

**Fix:** Run the audit locally to find the issue.

```bash
npm run repo:audit
```

_Then follow Case 2._

---

## 5. Engineering workflow

1. **Never** use `git add .` blindly if you have build artifacts generated.
2. **Never** use `-f` (force) to bypass `.gitignore`.
3. **Always** rely on `npm run repo:check` if you are unsure about the state of your repo.

---

## 6. Maintenance

To update the allowed/forbidden lists, modify:

1. `.gitignore`
2. `scripts/check-staged-files.sh`
3. `scripts/verify-repo.sh`
